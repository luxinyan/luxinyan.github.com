<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Luxinyan's Blog">
<meta property="og:url" content="http://iluxinyan.com/index.html">
<meta property="og:site_name" content="Luxinyan's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Luxinyan's Blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Luxinyan's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Luxinyan's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">夏虫语冰</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/C语言的宏/" itemprop="url">
                  C语言的宏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2017-02-23T11:39:17+08:00" content="2017-02-23">
              2017-02-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="C编译器提供的相关参数"><a href="#C编译器提供的相关参数" class="headerlink" title="C编译器提供的相关参数"></a>C编译器提供的相关参数</h2><ul>
<li>#</li>
<li>##</li>
<li><strong>FILE</strong>和<strong>LINE</strong>等</li>
<li>…和<strong>VA_ARGS</strong></li>
<li>##<strong>VA_ARGS</strong></li>
</ul>
<h2 id="“-”"><a href="#“-”" class="headerlink" title="“#”"></a>“#”</h2><p>把参数转换成字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STR(arg) #arg</span></div><div class="line">		NSLog(@<span class="string">"%s"</span>, STR(no qutoes);</div><div class="line"></div><div class="line">#define OCSTR(arg) @#arg</div><div class="line">		NSLog(OCSTR(This is a <span class="built_in">string</span>));</div></pre></td></tr></table></figure>
<h2 id="“-”-1"><a href="#“-”-1" class="headerlink" title="“##”"></a>“##”</h2><p>连接</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEF_VAR(type, name) type type##_##name</span></div><div class="line">		DEF_VAR(<span class="keyword">int</span>, a) = <span class="number">5</span>;</div><div class="line">		NSLog(@<span class="string">"%d"</span>, int_a);</div><div class="line">```	</div><div class="line"></div><div class="line">## 一些有用的参数</div><div class="line"></div><div class="line">```<span class="function">C</span></div><div class="line"><span class="title">NSLog</span><span class="params">(@<span class="string">"%s\n%d\n%s\n%s\n%s\n%s"</span>,</span></div><div class="line"> __FILE__, <span class="comment">//⽂文件全路路径</span></div><div class="line"> __LINE__, <span class="comment">//行号</span></div><div class="line"> __DATE__, <span class="comment">//预编译时的日期</span></div><div class="line"> __TIME__, <span class="comment">//预编译时的时间</span></div><div class="line"> __TIMESTAMP__, <span class="comment">//预编译⽇日期时间</span></div><div class="line"> __FUNCTION__); <span class="comment">//当前函数</span></div><div class="line">```		</div><div class="line"></div><div class="line">## 可变参数宏</div><div class="line"></div><div class="line">### “__VA_ARGS__”</div><div class="line"></div><div class="line">```C</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_LOG(str, ...) NSLog(@<span class="string">"【"</span>__FILE__<span class="string">":%d】"</span>str, __LINE__, __VA_ARGS__) </span></div><div class="line"></div><div class="line">MY_LOG(<span class="string">"%d %d %d"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line"></div><div class="line"><span class="string">"%d %d %d"</span> &gt; str </div><div class="line"><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &gt; __VA_ARGS__</div><div class="line"></div><div class="line"></div><div class="line"><span class="string">"【/blalbal/:12】1 2 3"</span></div></pre></td></tr></table></figure>
<h3 id="“-VA-ARGS”"><a href="#“-VA-ARGS”" class="headerlink" title="“##VA_ARGS”"></a>“##<strong>VA_ARGS</strong>”</h3><p>如果只有一个参数呢</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MY_LOG(<span class="string">"only one parameters"</span>);</div><div class="line">NSLog(@<span class="string">"【"</span><span class="string">"/file/path/file.m"</span><span class="string">":%d】"</span><span class="string">"only one parameters"</span>, <span class="number">42</span>, );</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_LOG(str, ...) NSLog(@<span class="string">"【"</span>__FILE__<span class="string">":%d】"</span>str, __LINE__, ##__VA_ARGS__) </span></div><div class="line"></div><div class="line">##__VA_ARGS__ 为空时会吞掉前面的引号</div></pre></td></tr></table></figure>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="KEY-PATH-提示"><a href="#KEY-PATH-提示" class="headerlink" title="KEY_PATH 提示"></a>KEY_PATH 提示</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_PATH(CLASS, PATH) \ </span></div><div class="line">(((<span class="keyword">void</span>)(NO &amp;&amp; ((<span class="keyword">void</span>)[CLASS <span class="keyword">new</span>].PATH, NO)), @# PATH))</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)JSONKeyPathsByPropertyKey &#123;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> @&#123;</div><div class="line">			KEY_PATH(SomeClass, property1): @<span class="string">"property_1"</span>,</div><div class="line">			KEY_PATH(SomeClass, property2): @<span class="string">"property_2"</span>,</div><div class="line">			KEY_PATH(SomeClass, property3): @<span class="string">"property_3"</span>, </div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(((void)(NO &amp;&amp; ((void)[SomeClass new].property1, NO)), @&quot;property1&quot;)): @&quot;property_1&quot;,</div></pre></td></tr></table></figure>
<h3 id="玩转可变参数"><a href="#玩转可变参数" class="headerlink" title="玩转可变参数"></a>玩转可变参数</h3><h4 id="ARG-AT"><a href="#ARG-AT" class="headerlink" title="ARG_AT"></a>ARG_AT</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ARG_AT(INDEX, ...) _ARG_AT##INDEX(__VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT0(_0, ...) _0 </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT1(_0, _1, ...) _1 </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT2(_0, _1, _2, ...) _2 </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT3(_0, _1, _2, _3, ...) _3 </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT4(_0, _1, _2, _3, _4, ...) _4 </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _ARG_AT5(_0, _1, _2, _3, _4, _5, ...) _5</span></div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> value = ARG_AT(<span class="number">3</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>);</div><div class="line"><span class="keyword">int</span> value = _ARG_AT##<span class="number">3</span>(<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>);</div><div class="line"><span class="keyword">int</span> value = _ARG_AT3(<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>);</div><div class="line"><span class="comment">// #define _ARG_AT3(_0, _1, _2, _3, ...) _3 </span></div><div class="line"><span class="keyword">int</span> value = <span class="number">400</span>;</div></pre></td></tr></table></figure>
<p>PS: 参数&lt;=5</p>
<h4 id="ARG-COUNT"><a href="#ARG-COUNT" class="headerlink" title="ARG_COUNT"></a>ARG_COUNT</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ARG_COUNT(...) \ </span></div><div class="line">ARG_AT(<span class="number">5</span>, ##__VA_ARGS__, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>)</div></pre></td></tr></table></figure>
<h4 id="DEC"><a href="#DEC" class="headerlink" title="DEC"></a>DEC</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEC(N) \ ARG_AT(N, -1, 0, 1, 2, 3, 4)</span></div></pre></td></tr></table></figure>
<p>vs</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEC(N) N - 1</span></div></pre></td></tr></table></figure>
<p> 为啥？<br> 预编译后就能拿到结果</p>
<h4 id="IS-EQ"><a href="#IS-EQ" class="headerlink" title="IS_EQ"></a>IS_EQ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IS_EQ(A, B)   _CONCAT(_IS_EQ, A)(B)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _CONCAT(A, B)   A ## B</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0(B)    _CONCAT(_IS_EQ0_, B)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_0   1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_1   0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_2   0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_3   0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_4   0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ0_5   0</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ1(B)    _IS_EQ0(DEC(B))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ2(B)    _IS_EQ1(DEC(B))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ3(B)    _IS_EQ2(DEC(B))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ4(B)    _IS_EQ3(DEC(B))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _IS_EQ5(B)    _IS_EQ4(DEC(B))</span></div></pre></td></tr></table></figure>
<p>一步一步展开</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">IS_EQ(<span class="number">2</span>, <span class="number">3</span>);</div><div class="line">_CONCAT(_IS_EQ, <span class="number">2</span>)(<span class="number">3</span>);</div><div class="line">_IS_EQ ## <span class="number">2</span>(<span class="number">3</span>);</div><div class="line">_IS_EQ2(<span class="number">3</span>);</div><div class="line">_IS_EQ1(DEC(<span class="number">3</span>));</div><div class="line">_IS_EQ1(<span class="number">2</span>);</div><div class="line">_IS_EQ0(DEC(<span class="number">2</span>))</div><div class="line">_IS_EQ0(<span class="number">1</span>)</div><div class="line">_CONCAT(_IS_EQ0_, <span class="number">1</span>)</div><div class="line">_IS_EQ0_1 <span class="number">0</span></div></pre></td></tr></table></figure>
<h3 id="综合应用-metamacro-foreach"><a href="#综合应用-metamacro-foreach" class="headerlink" title="综合应用-metamacro_foreach"></a>综合应用-metamacro_foreach</h3><p><a href="https://github.com/jspahrsummers/libextobjc/blob/master/extobjc/metamacros.h#L53" target="_blank" rel="external">libextobjc库中的宏metamacro_foreach</a></p>
<p>metamacro_foreach(MACRO, SEP, …)<br>参数有三部分，<code>MACRO</code>, <code>SEP</code> 和需要处理的数据 <code>VAL</code><br>实现的功能是，把每个<code>VAL</code>和对应的<code>INDEX</code>通过<code>MACRO</code>处理，得到的结果通过<code>SEP</code>连接</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> stringify(INDEX, VALUE) \</span></div><div class="line">    # INDEX metamacro_stringify(VALUE)</div><div class="line">    </div><div class="line">metamacro_foreach(stringify,<span class="string">"-"</span>, <span class="number">0</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">metamacro_foreach_cxt(metamacro_foreach_iter, <span class="string">"-"</span>, stringify, <span class="number">0</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">metamacro_concat(metamacro_foreach_cxt, metamacro_argcount(<span class="number">0</span>, <span class="number">1</span>))(stringify, <span class="string">"-"</span>, CONTEXT, <span class="number">0</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">metamacro_concat(metamacro_foreach_cxt, <span class="number">2</span>)(stringify, <span class="string">"-"</span>, CONTEXT, <span class="number">0</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> metamacro_foreach_cxt0(MACRO, SEP, CONTEXT)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> metamacro_foreach_cxt1(MACRO, SEP, CONTEXT, _0) MACRO(0, CONTEXT, _0)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> metamacro_foreach_cxt2(MACRO, SEP, CONTEXT, _0, _1) \</span></div><div class="line">    metamacro_foreach_cxt1(MACRO, SEP, CONTEXT, _0) \</div><div class="line">    SEP \</div><div class="line">    MACRO(1, CONTEXT, _1)</div><div class="line">    </div><div class="line">   </div><div class="line"></div><div class="line">metamacro_foreach_cxt2(stringify, <span class="string">"-"</span>, CONTEXT, <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">metamacro_foreach_cxt1(stringify, <span class="string">"-"</span>, CONTEXT, <span class="number">0</span>)<span class="string">"-"</span>stringify(<span class="number">1</span>, CONTEXT, <span class="number">1</span>)</div><div class="line">metamacro_foreach_cxt0(stringify, <span class="string">"-"</span>, CONTEXT, <span class="number">0</span>)stringify(<span class="number">1</span>, CONTEXT, <span class="number">1</span>)<span class="string">"-"</span>stringify(<span class="number">1</span>, CONTEXT, <span class="number">1</span>)</div><div class="line">stringify(<span class="number">0</span>, CONTEXT, <span class="number">0</span>)<span class="string">"-"</span>stringify(<span class="number">1</span>, CONTEXT, <span class="number">1</span>)</div><div class="line"><span class="string">"00"</span><span class="string">"-"</span><span class="string">"11"</span></div><div class="line"><span class="string">"00-11"</span></div></pre></td></tr></table></figure>
<p>根据需要处理数据的个数，生成 metamacro_foreach_cxtN，metamacro_foreach_cxtN 里面还定义了 metamacro_foreach_cxt(N-1), 并且展开宏 MACRO(INDEX(N-1), CONTEXT, (VALN-1))，并且会有一个SEP在前面，然后依次展开 metamacro_foreach_cxt(N-2)，metamacro_foreach_cxt(N-3)，最后得到一个整体的结果<br>00-11</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/09/webpack-初窥/" itemprop="url">
                  webpack 初窥
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2017-02-09T14:21:17+08:00" content="2017-02-09">
              2017-02-09
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/media/14866223604915.jpg" alt=""></p>
<h1 id="webpack-解决了什么问题？"><a href="#webpack-解决了什么问题？" class="headerlink" title="webpack 解决了什么问题？"></a>webpack 解决了什么问题？</h1><blockquote>
<p>webpack is a tool to build JavaScript modules in your application.<br>……<br>webpack simplifies your workflow by quickly constructing a dependency graph of your application and bundling them in the right order. webpack can be configured to customise optimisations to your code, to split vendor/css/js code for production, run a development server that hot-reloads your code without page refresh and many such cool features.</p>
</blockquote>
<p>简单来说就是<code>包管理</code>，并且对随之来的的新问题<code>包大小</code>进行优化。</p>
<p>因为 JS 本身没有 package 的概念，最初始的方式是通过 <code>&lt;script&gt;</code> 的方式来加载，这种方式很容易出问题，比如如果三方库还没加载下来，代码就执行了，就会出错。有了 node 之后，npm 提供了包管理，webpack 就是提前把这些依赖关系处理好，生成一个 bundle.js 进行使用。</p>
<p>之前的三方库使通过 script tag 来进行应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">component</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* lodash is required for the next line to work */</span></div><div class="line">  element.innerHTML = _.join([<span class="string">'Hello'</span>,<span class="string">'webpack'</span>], <span class="string">' '</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> element;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.body.appendChild(component());</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">--</span> <span class="attr">index.html</span> <span class="attr">--</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack 2 demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/lodash@4.16.6"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app/index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>使用以下命令，通过 npm 安装 lodash, 使用了 webpack 之后，配合 import/export 关键字 webpack 会提前处理好依赖关系，生成一个 bundle.js。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save lodash</div><div class="line">./node_modules/.bin/webpack app/index.js dist/bundle.js</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">component</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  element.innerHTML = _.join([<span class="string">'hello'</span>, <span class="string">'webpack'</span>], <span class="string">' '</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> element;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.body.appendChild(component());</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../dist/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这样各种包的依赖关系在用户加载的时候就已经确定了，开发人员在开发的时候也不容易犯错。</p>
<h1 id="webpack-带来了什么新问题？"><a href="#webpack-带来了什么新问题？" class="headerlink" title="webpack 带来了什么新问题？"></a>webpack 带来了什么新问题？</h1><p>提前生成一个已经处理好依赖关系的 bundle.js 确实有很多好处，但是也带来了一个问题，如果所有 JS 代码都在一个文件里，那这个问题件会很大，用户首次加载会耗时比较久，好在 webpack 也提供了 Code Split 来解决这个问题，我之后再研究一下。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/14/源码阅读-AFNetworking之AFURLSessionManager-(一)/" itemprop="url">
                  源码阅读-AFNetworking之AFURLSessionManager (一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-03-14T00:50:17+08:00" content="2016-03-14">
              2016-03-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="AFURLSessionManager-解析"><a href="#AFURLSessionManager-解析" class="headerlink" title="AFURLSessionManager 解析"></a>AFURLSessionManager 解析</h1><p>AFNetworking 3.0 提供了 <code>AFURLSessionManager</code> 来处理 HTTP 请求, 使用方式如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</div><div class="line"></div><div class="line"><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://example.com/upload"</span>];</div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:URL];</div><div class="line"></div><div class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask = [manager dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error) &#123;</div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, response, responseObject);</div><div class="line">    &#125;</div><div class="line">&#125;];</div><div class="line">[dataTask resume];</div></pre></td></tr></table></figure>
<p>不难看出, 3.0完全是基于 NSURLSession 来实现的, 下面我们就来看看源码中的实现细节</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">- (instancetype)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!configuration) &#123;</div><div class="line">        configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.sessionConfiguration = configuration;</div><div class="line"></div><div class="line">    <span class="comment">//创建一个并行的队列, 但是 maxConcurrentOperationCount 设为 1, 相当于一个串行队列</span></div><div class="line">    <span class="keyword">self</span>.operationQueue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.operationQueue.maxConcurrentOperationCount = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="comment">//初始化session, 传入 self.operationQueue</span></div><div class="line">    <span class="keyword">self</span>.session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:<span class="keyword">self</span>.sessionConfiguration delegate:<span class="keyword">self</span> delegateQueue:<span class="keyword">self</span>.operationQueue];</div><div class="line">    <span class="comment">//设置 response 解析方式, 当成 JSON 来解析, 如果我们需要改变解析形式, 只需要在初始化之后修改 responseSerializer</span></div><div class="line">    <span class="keyword">self</span>.responseSerializer = [AFJSONResponseSerializer serializer];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.securityPolicy = [AFSecurityPolicy defaultPolicy];</div><div class="line"></div><div class="line"><span class="meta">#if !TARGET_OS_WATCH</span></div><div class="line">    <span class="keyword">self</span>.reachabilityManager = [AFNetworkReachabilityManager sharedManager];</div><div class="line"><span class="meta">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">//一个用来存放task 所对应的 delegate 的 NSMutableDictionary, key 为TaskIdentifier, 其实就是内存指针地址</span></div><div class="line">    <span class="keyword">self</span>.mutableTaskDelegatesKeyedByTaskIdentifier = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</div><div class="line"></div><div class="line">    <span class="comment">//操作 mutableTaskDelegatesKeyedByTaskIdentifier 的时候使用的锁</span></div><div class="line">    <span class="keyword">self</span>.lock = [[<span class="built_in">NSLock</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.lock.name = AFURLSessionManagerLockName;</div><div class="line"></div><div class="line">    <span class="comment">//清空 session 中 task 的所有 handler</span></div><div class="line">    [<span class="keyword">self</span>.session getTasksWithCompletionHandler:^(<span class="built_in">NSArray</span> *dataTasks, <span class="built_in">NSArray</span> *uploadTasks, <span class="built_in">NSArray</span> *downloadTasks) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionDataTask</span> *task <span class="keyword">in</span> dataTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForDataTask:task uploadProgress:<span class="literal">nil</span> downloadProgress:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionUploadTask</span> *uploadTask <span class="keyword">in</span> uploadTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForUploadTask:uploadTask progress:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSURLSessionDownloadTask</span> *downloadTask <span class="keyword">in</span> downloadTasks) &#123;</div><div class="line">            [<span class="keyword">self</span> addDelegateForDownloadTask:downloadTask progress:<span class="literal">nil</span> destination:<span class="literal">nil</span> completionHandler:<span class="literal">nil</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h1><h2 id="NSFoundationVersionNumber-比较版本号"><a href="#NSFoundationVersionNumber-比较版本号" class="headerlink" title="NSFoundationVersionNumber 比较版本号"></a>NSFoundationVersionNumber 比较版本号</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifndef NSFoundationVersionNumber_iOS_8_0</span></div><div class="line"><span class="meta">#define NSFoundationVersionNumber_With_Fixed_5871104061079552_bug 1140.11</span></div><div class="line"><span class="meta">#else</span></div><div class="line"><span class="meta">#define NSFoundationVersionNumber_With_Fixed_5871104061079552_bug NSFoundationVersionNumber_iOS_8_0</span></div><div class="line"><span class="meta">#endif</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">NSFoundationVersionNumber</span> &lt; <span class="built_in">NSFoundationVersionNumber_With_Fixed_5871104061079552_bug</span>) &#123;</div><div class="line">        <span class="comment">// Fix of bug</span></div><div class="line">        <span class="comment">// Open Radar:http://openradar.appspot.com/radar?id=5871104061079552 (status: Fixed in iOS8)</span></div><div class="line">        <span class="comment">// Issue about:https://github.com/AFNetworking/AFNetworking/issues/2093</span></div><div class="line">        <span class="built_in">dispatch_sync</span>(url_session_manager_creation_queue(), block);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>直接使用自带的<code>NSFoundationVersionNumber</code>来进行版本号的比较<code>NSFoundationVersionNumber</code>就是当前版本, <code>NSFoundationVersionNumber_iOS_8_0</code>就是 <code>iOS8.0</code></p>
<h2 id="NSStringFromSelector-selector-来写keypath"><a href="#NSStringFromSelector-selector-来写keypath" class="headerlink" title="NSStringFromSelector(@selector()) 来写keypath"></a>NSStringFromSelector(@selector()) 来写keypath</h2><p>使用<code>NSStringFromSelector(@selector(countOfBytesReceived))</code>来写keypath, 这样更直观。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[task addObserver:self</div><div class="line">       forKeyPath:NSStringFromSelector(@selector(countOfBytesReceived))</div><div class="line">          options:NSKeyValueObservingOptionNew</div><div class="line">          context:NULL];</div></pre></td></tr></table></figure>
<h2 id="用-dispatch-semaphore-t-把异步任务变成同步"><a href="#用-dispatch-semaphore-t-把异步任务变成同步" class="headerlink" title="用 dispatch_semaphore_t 把异步任务变成同步"></a>用 dispatch_semaphore_t 把异步任务变成同步</h2><p>通过<code>dispatch_semaphore_t</code>使<code>getTasksWithCompletionHandler</code>这个异步任务变成同步, 直到获得 tasks 才返回。<code>NSStringFromSelector(_cmd)</code>直接使用当前调用的函数为<code>selector</code>。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)tasksForKeyPath:(<span class="built_in">NSString</span> *)keyPath &#123;</div><div class="line">    __block <span class="built_in">NSArray</span> *tasks = <span class="literal">nil</span>;</div><div class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">0</span>);</div><div class="line">    [<span class="keyword">self</span>.session getTasksWithCompletionHandler:^(<span class="built_in">NSArray</span> *dataTasks, <span class="built_in">NSArray</span> *uploadTasks, <span class="built_in">NSArray</span> *downloadTasks) &#123;</div><div class="line">        <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(dataTasks))]) &#123;</div><div class="line">            tasks = dataTasks;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(uploadTasks))]) &#123;</div><div class="line">            tasks = uploadTasks;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(downloadTasks))]) &#123;</div><div class="line">            tasks = downloadTasks;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(tasks))]) &#123;</div><div class="line">            tasks = [@[dataTasks, uploadTasks, downloadTasks] valueForKeyPath:<span class="string">@"@unionOfArrays.self"</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        dispatch_semaphore_signal(semaphore);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> tasks;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> *)tasks &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> tasksForKeyPath:<span class="built_in">NSStringFromSelector</span>(_cmd)];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> *)dataTasks &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> tasksForKeyPath:<span class="built_in">NSStringFromSelector</span>(_cmd)];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> *)uploadTasks &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> tasksForKeyPath:<span class="built_in">NSStringFromSelector</span>(_cmd)];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> *)downloadTasks &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> tasksForKeyPath:<span class="built_in">NSStringFromSelector</span>(_cmd)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/09/RAC-使用技巧/" itemprop="url">
                  RAC 使用技巧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-02-09T14:21:17+08:00" content="2016-02-09">
              2016-02-09
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="实用技巧"><a href="#实用技巧" class="headerlink" title="实用技巧"></a>实用技巧</h1><h2 id="使用-RAC-添加一个-backgroundTask"><a href="#使用-RAC-添加一个-backgroundTask" class="headerlink" title="使用 RAC 添加一个 backgroundTask"></a>使用 RAC 添加一个 backgroundTask</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIBackgroundTaskIdentifier</span> backgroundTask = [[<span class="built_in">UIApplication</span> sharedApplication] beginBackgroundTaskWithExpirationHandler:^&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Ran out of time"</span>);</div><div class="line">&#125;];</div><div class="line"> </div><div class="line">RACSignal *taskSignal = [<span class="keyword">self</span>.repository save];</div><div class="line"> </div><div class="line">[taskSignal subscribeError:^(<span class="built_in">NSError</span> *error) &#123;</div><div class="line">    [[<span class="built_in">UIApplication</span> sharedApplication] endBackgroundTask:backgroundTask];</div><div class="line">&#125; completed:^&#123;</div><div class="line">    [[<span class="built_in">UIApplication</span> sharedApplication] endBackgroundTask:backgroundTask];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h2 id="观察消息的正确姿势"><a href="#观察消息的正确姿势" class="headerlink" title="观察消息的正确姿势"></a>观察消息的正确姿势</h2><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/issues/365" target="_blank" rel="external">https://github.com/ReactiveCocoa/ReactiveCocoa/issues/365</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// X</span></div><div class="line">[[[<span class="built_in">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class="built_in">UIApplicationDidBecomeActiveNotification</span> object:<span class="literal">nil</span>]</div><div class="line">subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">   <span class="comment">// do something</span></div><div class="line">&#125;];</div><div class="line">    </div><div class="line"><span class="comment">// √</span></div><div class="line">[[[[<span class="built_in">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class="built_in">UIApplicationDidBecomeActiveNotification</span> object:<span class="literal">nil</span>]</div><div class="line">takeUntil:[<span class="keyword">self</span> rac_willDeallocSignal]]</div><div class="line">subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">   <span class="comment">// do something</span></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h2 id="doAroundNext"><a href="#doAroundNext" class="headerlink" title="doAroundNext"></a>doAroundNext</h2><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/issues/1731" target="_blank" rel="external">https://github.com/ReactiveCocoa/ReactiveCocoa/issues/1731</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)doAroundNext:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> x, <span class="keyword">void</span> (^yield)()))nextBlock &#123;</div><div class="line">  <span class="built_in">NSCParameterAssert</span>(nextBlock != <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> [[RACSignal create:^(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [<span class="keyword">self</span> subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">      <span class="keyword">void</span> (^yielder)() = ^&#123;</div><div class="line">        [subscriber sendNext:x];</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">      nextBlock(x, yielder);</div><div class="line">    &#125; error:^(<span class="built_in">NSError</span> *error) &#123;</div><div class="line">      [subscriber sendError:error];</div><div class="line">    &#125; completed:^&#123;</div><div class="line">      [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">  &#125;] setNameWithFormat:<span class="string">@"[%@] -%@"</span>, <span class="keyword">self</span>.name, <span class="built_in">NSStringFromSelector</span>(_cmd)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="RAC-定时器"><a href="#RAC-定时器" class="headerlink" title="RAC 定时器"></a>RAC 定时器</h2><p>如果需要倒计时到0，可以改最后的x.intValue &lt; 0, 如果不需要开始的值，去掉startWith, 订阅一般是收获的阶段，所以尽量不要在订阅的时候加以控制</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+ (RACSignal *)makeTimer(<span class="keyword">int</span> times) &#123;</div><div class="line">    RACSignal *timer = [RACSignal interval:<span class="number">1</span> onScheduler:[RACScheduler mainThreadScheduler]];</div><div class="line">    <span class="keyword">return</span> [[[timer scanWithStart:@(times) reduce:^<span class="keyword">id</span>(<span class="built_in">NSNumber</span> *running, <span class="keyword">id</span> _) &#123;</div><div class="line">        <span class="keyword">return</span> @(running.intValue - <span class="number">1</span>);</div><div class="line">    &#125;] startWith:@(times)]</div><div class="line">    takeUntilBlock:^<span class="built_in">BOOL</span>(<span class="built_in">NSNumber</span> *x) &#123;</div><div class="line">        <span class="keyword">return</span> x.intValue == <span class="number">0</span>;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="在TableViewCell-的-subView-中绑定事件"><a href="#在TableViewCell-的-subView-中绑定事件" class="headerlink" title="在TableViewCell 的 subView 中绑定事件"></a>在TableViewCell 的 subView 中绑定事件</h2><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/issues/490" target="_blank" rel="external">https://github.com/ReactiveCocoa/ReactiveCocoa/issues/490</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[[[cell.okButton</div><div class="line">    rac_signalForControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>]</div><div class="line">    takeUntil:cell.rac_prepareForReuseSignal]</div><div class="line">    subscribeNext:^(<span class="built_in">UIButton</span> *x) &#123;</div><div class="line">        MXThing *thing = <span class="keyword">self</span>.things[indexPath.row];</div><div class="line">        <span class="comment">// use this thing</span></div><div class="line">    &#125;];</div><div class="line"></div><div class="line">[[[cell.cancelButton rac_signalForControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>]</div><div class="line">    takeUntil:cell.rac_prepareForReuseSignal]</div><div class="line">    subscribeNext:^(<span class="built_in">UIButton</span> *x) &#123;</div><div class="line">        <span class="comment">// do other things</span></div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<h2 id="注意-NSCalendar-的使用"><a href="#注意-NSCalendar-的使用" class="headerlink" title="注意 NSCalendar 的使用"></a>注意 NSCalendar 的使用</h2><p><img src="media/14709339180888.jpg" alt=""></p>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p><a href="https://zhuanlan.zhihu.com/p/22090471" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/22090471</a></p>
<h1 id="Operator-操作注意"><a href="#Operator-操作注意" class="headerlink" title="Operator 操作注意"></a>Operator 操作注意</h1><h2 id="simple-的使用"><a href="#simple-的使用" class="headerlink" title="simple 的使用"></a>simple 的使用</h2><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/issues/977" target="_blank" rel="external">https://github.com/ReactiveCocoa/ReactiveCocoa/issues/977</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[RACSignal zip:@[ signalA, [signalB sample:signalA] ]]</div></pre></td></tr></table></figure>
<h2 id="理解-switchToLatest"><a href="#理解-switchToLatest" class="headerlink" title="理解 switchToLatest"></a>理解 switchToLatest</h2><p>解释了就没意思了，大家思考下几个重点的问题吧： </p>
<ol>
<li>为什么要publish self？ </li>
<li>对connection.signal做FlattenMap干什么？ </li>
<li>对next value里面的signal为什么要做takeUntil？ 而且还是connection.signal </li>
<li>为什么要concat一个never信号？ </li>
<li>最后的return的disposable为什么这样写？ </li>
<li>分析下取消订阅的过程</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)switchToLatest &#123;</div><div class="line">	<span class="keyword">return</span> [[RACSignal createSignal:^(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">		RACMulticastConnection *connection = [<span class="keyword">self</span> publish];</div><div class="line"></div><div class="line">		RACDisposable *subscriptionDisposable = [[connection.signal</div><div class="line">			flattenMap:^(RACSignal *x) &#123;</div><div class="line">				<span class="built_in">NSCAssert</span>(x == <span class="literal">nil</span> || [x isKindOfClass:RACSignal.class], <span class="string">@"-switchToLatest requires that the source signal (%@) send signals. Instead we got: %@"</span>, <span class="keyword">self</span>, x);</div><div class="line"></div><div class="line">				<span class="comment">// -concat:[RACSignal never] prevents completion of the receiver from</span></div><div class="line">				<span class="comment">// prematurely terminating the inner signal.</span></div><div class="line">				<span class="keyword">return</span> [x takeUntil:[connection.signal concat:[RACSignal never]]];</div><div class="line">			&#125;]</div><div class="line">			subscribe:subscriber];</div><div class="line"></div><div class="line">		RACDisposable *connectionDisposable = [connection connect];</div><div class="line">		<span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</div><div class="line">			[subscriptionDisposable dispose];</div><div class="line">			[connectionDisposable dispose];</div><div class="line">		&#125;];</div><div class="line">	&#125;] setNameWithFormat:<span class="string">@"[%@] -switchToLatest"</span>, <span class="keyword">self</span>.name];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><p>为什么要延迟创建信号呢？是因为创建信号的某些必要的量或者方法只在那时才有效。比如一个信号表示当前时间，需要一个[NSDate date]值，如果创建信号的时候给了[RACSignal return:[NSDate date]]，就是未来订阅的时候，得到的仍然是创建的时间。但是用defer就可以订阅得到那时的时间了。</p>
<h2 id="RACObserve-cold-or-hot"><a href="#RACObserve-cold-or-hot" class="headerlink" title="RACObserve cold or hot?"></a>RACObserve cold or hot?</h2><p>首先它这个冷信号的意义，就是发旧的值和未来的变化值。所以是一个副作用的冷信号,它能保证每次订阅都是按照这个规则，所以各个订阅之间其实没有关系<br>相当于 [RACSignal retrun:@1]无论订阅多少次都是一样的效果,这个是可以随便重复订阅的,从某种意义上讲，也算是热信号</p>
<h2 id="热信号"><a href="#热信号" class="headerlink" title="热信号"></a>热信号</h2><p>如果要拆分信号，在拆分前的信号转换成热信号，防止重复计算<br>replay 会一直计算过去的值，内存会爆掉，使用 replayLast 会比较好</p>
<h2 id="swichToLatest"><a href="#swichToLatest" class="headerlink" title="swichToLatest"></a>swichToLatest</h2><p>dispose 上一个，订阅下一个</p>
<h2 id="flatten"><a href="#flatten" class="headerlink" title="flatten:"></a>flatten:</h2><p>参数和纬度无关，只和效率相关，参数相当于当前的并发数</p>
<h2 id="contact"><a href="#contact" class="headerlink" title="contact"></a>contact</h2><p>相当于 Flatten:1</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/01/Objective-C中的Associated Object/" itemprop="url">
                  Objective-C中的Associated Object
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-01T23:50:17+08:00" content="2015-05-01">
              2015-05-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>有时候需要在现有的对象中添加信息，我们可用通过创建一个子类，用子类创建的对象替代原有的对象。这种方式需要新建一个类，而且有时候由于一些限制，无法创建子类。Objective-C中有一项强大的特性可以解决这个问题，那就是<code>关联对象</code>(Associated Objective)。</p>
</blockquote>
<p>###使用方式<br>比如我们使用 UIAlertView 的时候，用户按下按钮之后，需要用 Delegate 来处理操作，这样每一个alertView的视图创建代码和按钮处理代码就要分开，如果 alertView 很多的时候就会显得很乱。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* UIAlertView 一般使用方法</div><div class="line">*/</div><div class="line"><span class="built_in">UIAlertView</span> *alertView = [[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"Title"</span> message:<span class="string">@"message"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"Cancle"</span> otherButtonTitles:<span class="string">@"OK"</span>, <span class="literal">nil</span>];</div><div class="line"></div><div class="line">[alertView show];</div><div class="line">    </div><div class="line"><span class="comment">//UIAlertViewDelegate</span></div><div class="line">-(<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span> *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (buttonIndex ==<span class="number">0</span> ) &#123;</div><div class="line">    	<span class="built_in">NSLog</span>(<span class="string">@"cancel button did press"</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="built_in">NSLog</span>(<span class="string">@"other button did press"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果能在 alertView 创建的时候就把按钮所对应的逻辑操作通过 Block 设置好, 然后在 Delegate 中直接调取对应 alertView 的 Block 进行操作, 这样代码就清晰很多, 我们可以通过<code>Associated Object</code>来给 alertView 添加临时的信息.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* 用 Associated Objective 设置 button action</div><div class="line">**/</div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span> //导入 runtime</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> *AlertViewKey = <span class="string">"AlertViewKey"</span>; <span class="comment">//Associated Object的 key</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^AlertBlock)(<span class="built_in">NSInteger</span>);</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="built_in">UIAlertView</span> *alertView = [[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"Title"</span> message:<span class="string">@"message"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"Cancle"</span> otherButtonTitles:<span class="string">@"OK"</span>, <span class="literal">nil</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//alertView 按钮的逻辑操作</span></div><div class="line">    AlertBlock alertBlock = ^(<span class="built_in">NSInteger</span> buttonIndex)&#123;</div><div class="line">        <span class="keyword">if</span> (buttonIndex == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"cancel button did press"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"other button did press"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="comment">//吧 alertBlock 设置成 alertView 的 Associated Object, key 为 AlertViewKey</span></div><div class="line">    objc_setAssociatedObject(alertView, AlertViewKey, alertBlock, OBJC_ASSOCIATION_COPY);</div><div class="line"></div><div class="line">    [alertView show];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//UIAlertViewDelegate</span></div><div class="line">-(<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span> *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</div><div class="line">&#123;</div><div class="line">	<span class="comment">//获得alertView 中 key 为"AlertViewKey" 的相关信息</span></div><div class="line">    AlertBlock alertBlock = objc_getAssociatedObject(alertView, AlertViewKey);</div><div class="line"></div><div class="line">    alertBlock(buttonIndex);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="相关方法"><a href="#相关方法" class="headerlink" title="相关方法"></a>相关方法</h3><p>现在我们来了解一下<code>Associated Object</code>,</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//给对象`设置`Associated Object, 每一个 Associated Object 对应一个 key</span></div><div class="line"><span class="keyword">void</span> objc_setAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy)</div><div class="line"></div><div class="line"><span class="comment">// 通过 key 来`获取`对象的Associated Object</span></div><div class="line"><span class="keyword">id</span> objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</div><div class="line"></div><div class="line"><span class="comment">//`移除`对象中所有的 Associated Object</span></div><div class="line"><span class="keyword">void</span> objc_removeAssociatedObjects(<span class="keyword">id</span> object)</div></pre></td></tr></table></figure>
<h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><p>objc_AssociationPolicy属性是用来Associated Object的储存策略, 对应@property 的关系如下:</p>
<table>
<thead>
<tr>
<th>objc_AssociationPolicy</th>
<th>@property</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJC_ASSOCIATION_ASSIGN</td>
<td>assign</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td>
<td>nonatomatic, reatin</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY_NONATOMIC</td>
<td>nonatomic, copy</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN</td>
<td>retain</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY</td>
<td>copy</td>
</tr>
</tbody>
</table>
<p>使用 Block 的时候要注意设置存储策略来防止<code>Retain Cycle</code></p>
<p>还有要注意的是, key 的类型为<code>const void *key</code>, 所以这样设置比较好</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> *AlertViewKey = <span class="string">"AlertViewKey"</span>; <span class="comment">//Associated Object的 key</span></div></pre></td></tr></table></figure>
<h3 id="想要-KVO-怎么办"><a href="#想要-KVO-怎么办" class="headerlink" title="想要 KVO 怎么办"></a>想要 KVO 怎么办</h3><p>通过 Associated Object 添加的 property 是不会发出 KVO 的，如果想要实现的话，只要手动调用<code>willChangeValueForKey:</code>和<code>didChangeValueForKey:</code>就可以了，参考一下 MJRefresh 的代码。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> MJRefreshHeaderKey = <span class="string">'\0'</span>;</div><div class="line">- (<span class="keyword">void</span>)setMj_header:(MJRefreshHeader *)mj_header</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (mj_header != <span class="keyword">self</span>.mj_header) &#123;</div><div class="line">        <span class="comment">// 删除旧的，添加新的</span></div><div class="line">        [<span class="keyword">self</span>.mj_header removeFromSuperview];</div><div class="line">        [<span class="keyword">self</span> insertSubview:mj_header atIndex:<span class="number">0</span>];</div><div class="line">        </div><div class="line">        <span class="comment">// 存储新的</span></div><div class="line">        [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"mj_header"</span>]; <span class="comment">// KVO</span></div><div class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, &amp;MJRefreshHeaderKey,</div><div class="line">                                 mj_header, OBJC_ASSOCIATION_ASSIGN);</div><div class="line">        [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"mj_header"</span>]; <span class="comment">// KVO</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MJRefreshFooter *)mj_footer</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;MJRefreshFooterKey);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>可以通过 Associated Object 把两个对象连起来.</li>
<li>定义 Associated Object 时可以模仿@property 定义储存策略, 防止 Retain Cycle</li>
<li>只有在其他方法不奏效的时候才使用, 因为这种方法回来带难以查找的 bug</li>
<li>注意 KVO </li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/28/Objective-C中Block的存储域/" itemprop="url">
                  Objective-C中Block的存储域
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-04-28T15:08:17+08:00" content="2015-04-28">
              2015-04-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Block 在 Objective-C 中也是被当成对象的, Block 有三种类。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>设置对象的存储区域</th>
</tr>
</thead>
<tbody>
<tr>
<td>_NSConcreteStackBlock</td>
<td>栈</td>
</tr>
<tr>
<td>_NSConcreteClobalBlock</td>
<td>程序的数据区域(.data 区)</td>
</tr>
<tr>
<td>_NSConcreteMallocBlock</td>
<td>堆</td>
</tr>
</tbody>
</table>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span>(^globalBlock)(<span class="keyword">void</span>) = ^&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"globalBlock"</span>);</div><div class="line">&#125;;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, globalBlock); <span class="comment">//&lt;__NSGlobalBlock__: 0x105f6b0c0&gt;</span></div></pre></td></tr></table></figure>
<p>在没有捕获任何自动变量的时候, Block 的类型为<code>NSGlobalBlock</code>.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</div><div class="line"><span class="keyword">void</span>(^stacklBlock)(<span class="keyword">void</span>) = ^&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"stacklBlock, a = %d"</span>, a);</div><div class="line">&#125;;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, stacklBlock);<span class="comment">//&lt;__NSStackBlock__: 0x7fff59c94ac0&gt;</span></div></pre></td></tr></table></figure>
<p>捕获自动变量的时候, Block 的类型为<code>NSStackBlock</code>.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span>(^mallocBlock)(<span class="keyword">void</span>) = [stacklBlock <span class="keyword">copy</span>];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, mallocBlock);<span class="comment">//&lt;__NSMallocBlock__: 0x7fced2e8d240&gt;</span></div></pre></td></tr></table></figure>
<p>对 Block 在堆上进行复制的时候, 复制后的类型为<code>NSMallocBlock</code>.</p>
<p>将 Block 作为函数的返回值时, 编译器会自动生成复制到堆上的代码. Blocks 从栈上复制到堆中, 这样即使 Block 的变量作用域结束, 堆上的 Block 还可以继续存在.</p>
<p>在ARC开启的情况下，将只会有<code>NSConcreteGlobalBlock</code>和 <code>NSConcreteMallocBlock</code>类型的block。原本的<code>NSConcreteStackBlock</code>的block会被<code>NSConcreteMallocBlock</code>类型的block替代。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/09/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-09T14:21:17+08:00" content="2015-02-09">
              2015-02-09
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/01/Xcode6-New-Feature-2.Live Render/" itemprop="url">
                  Xcode6 New Feature - 2.Live Render
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-12-01T21:41:17+08:00" content="2014-12-01">
              2014-12-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Xcode6中可以创建可以在 storyboard 中进行修改的自定义空间.</p>
<h3 id="IBDesignable"><a href="#IBDesignable" class="headerlink" title="@IBDesignable"></a>@IBDesignable</h3><p>给控件所使用的<code>class</code>加上<code>@IBDesignable</code>前缀, 就可以让相应<code>class</code>中代码的修改, 马上更新到<code>storyboard</code>中.</p>
</blockquote>
<p>创建一个 <code>UIView</code>, 并让它的<code>class</code>为<code>CustomVierw</code>.<br><img src="/media/14888770172716.png" alt="创建一个 UIVIew, class 为 CustomView"></p>
<p>在<code>CustomView</code>的 class 前加上<code>@IBDesignable</code>前缀, 这样在<code>drawRect(rect: CGRect)</code>中的修改就会马上更新到<code>Stroyboard</code>中.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="meta">@IBDesignable</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomView</span>: <span class="title">UIView</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</div><div class="line">        <span class="type">UIColor</span>.redColor().setFill()</div><div class="line">        <span class="type">UIRectFill</span>(bounds)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/media/14888770401029.png" alt="通过@IBDesignable 对 View 进行更新"></p>
<p>###@IBInspectable<br>除了及时更新代码的修改之外, 我们还可以在 Inspect 中添加我们自定的属性调节选项.</p>
<p>首先, 我们需要创建一个 closure属性<code>borderWidth</code>(也就是说, 属性的值是通过 block 中的计算得出的)在自定义属性之前添加<code>@IBInspectable</code>前缀, <code>didSet</code>方法会在属性被修改之后调用, 我们可以在<code>didSet</code>中对属性进行操作, 这里只是简单的赋值.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IBInspectable</span> <span class="keyword">var</span> borderWidth: <span class="type">CGFloat</span> = <span class="number">10</span> &#123;</div><div class="line">    <span class="keyword">didSet</span> &#123;</div><div class="line">        <span class="comment">//call after varable was set</span></div><div class="line">        layer.borderWidth = borderWidth</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>回到 Srotyboard 中, 我们会发现, 在对应的 UIView 的 Inspect 中多了一个<code>borderWidth</code>的设置项, 这样我们就可以在 storyboard 中对 UI 进行实时修改了.</p>
<p><img src="/media/14888770585620.png" alt="Inspect 中多了一个 Border Width 的设置项"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/01/Xcode6-New-Feature-1.Playground/" itemprop="url">
                  Xcode6 New Feature - 1.Playground
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-12-01T21:13:17+08:00" content="2014-12-01">
              2014-12-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="直接运行代码"><a href="#直接运行代码" class="headerlink" title="直接运行代码"></a>直接运行代码</h3><p>Playground可以实现解释器一般的效果，输入代码之后，右边会马上显示出运行结果，并且还能出现图形化效果。</p>
<p><img src="/media/14888765886849.png" alt="Playground直接运行代码"></p>
<h3 id="使用-iOS库"><a href="#使用-iOS库" class="headerlink" title="使用 iOS库"></a>使用 iOS库</h3><p>并且可以使用<code>UIKit</code>, 来创建 cocoa 框架的对象, 快速地进行渲染, 但是渲染出的对象不会马上根据代码的变化而改变.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> frame = <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)</div><div class="line"><span class="keyword">let</span> view = <span class="type">UIView</span>(frame: frame)</div><div class="line">view.backgroundColor = <span class="type">UIColor</span>.redColor()</div></pre></td></tr></table></figure>
<p><img src="/media/14888766092100.png" alt="使用 Cocoa 对象"></p>
<h3 id="用-XCPlayground-来调试"><a href="#用-XCPlayground-来调试" class="headerlink" title="用 XCPlayground 来调试"></a>用 XCPlayground 来调试</h3><p>如果需要在 Playground 中进行方便的调试, 需要使用<code>XCPlayground</code>, 这样代码修改之后就会马上在右侧更新.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> XCPlayground</div><div class="line"></div><div class="line"><span class="keyword">let</span> frame = <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)</div><div class="line"><span class="keyword">let</span> view = <span class="type">UIView</span>(frame: frame)</div><div class="line">view.backgroundColor = <span class="type">UIColor</span>.redColor()</div><div class="line">\\add</div><div class="line"><span class="type">XCPShowView</span>(<span class="string">"View"</span>, view)</div></pre></td></tr></table></figure>
<h3 id="使用动画"><a href="#使用动画" class="headerlink" title="使用动画"></a>使用动画</h3><p>如果需要在<code>Playground</code>中模拟动画效果, 只需要在 Inspectable 中进行设置, 通过 simulator 进行模拟, 下方的滑动 slider 可以手动控控制动画的速度.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="keyword">import</span> XCPlayground</div><div class="line"></div><div class="line"><span class="keyword">let</span> numbers = <span class="number">1</span>...<span class="number">50</span></div><div class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers &#123;</div><div class="line">    sin(<span class="type">Double</span>(num)/<span class="number">2</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> frame = <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)</div><div class="line"><span class="keyword">let</span> view = <span class="type">UIView</span>(frame: frame)</div><div class="line">view.backgroundColor = <span class="type">UIColor</span>.redColor()</div><div class="line"><span class="type">XCPShowView</span>(<span class="string">"View"</span>, view)</div><div class="line"></div><div class="line"><span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"borderWidth"</span>)</div><div class="line">animation.fromValue = <span class="number">1</span></div><div class="line">animation.toValue = <span class="number">100</span></div><div class="line">animation.duration = <span class="number">5</span></div><div class="line">view.layer.addAnimation(animation, forKey: <span class="string">"borderWidth"</span>)</div></pre></td></tr></table></figure>
<p><img src="/media/14888766293197.png" alt="模拟动画"></p>
<h3 id="使用资源"><a href="#使用资源" class="headerlink" title="使用资源"></a>使用资源</h3><p>Playground 文件其实是一个包, 点击 Inspect中,  Resource Path的箭头进入 Resource 文件夹, 将你需要使用的资源文件复制进去, 就可以在 Playground 中使用了.</p>
<p><img src="/media/14888766443932.png" alt="Resoure Path"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> img = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"marvin.jpg"</span>))</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/14/网络数据解析-JSON&XML/" itemprop="url">
                  网络数据解析-JSON&XML
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2013-12-14T00:50:17+08:00" content="2013-12-14">
              2013-12-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##JSON<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *dict = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:<span class="built_in">NSJSONReadingMutableLeaves</span> error:<span class="literal">nil</span>];</div><div class="line"><span class="built_in">NSArray</span> *videoArray = dict[<span class="string">@"videos"</span>];</div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *videoDict <span class="keyword">in</span> videoArray) &#123;</div><div class="line">    HMVideo *video = [HMVideo videoWithDict:videoDict];</div><div class="line">    [<span class="keyword">self</span>.videos addObject:video];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##XML—GDataXML (DOM 方式)<br>DOM 方式直接读取整个文档<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> 加载服务器最新的视频信息</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="comment">// 1.创建URL</span></div><div class="line"><span class="built_in">NSURL</span> *url = HMUrl(<span class="string">@"video?type=XML"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 2.创建请求</span></div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</div><div class="line"></div><div class="line"><span class="comment">// 3.发送请求</span></div><div class="line">[<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</div><div class="line">    <span class="keyword">if</span> (connectionError || data == <span class="literal">nil</span>) &#123;</div><div class="line">        [MBProgressHUD showError:<span class="string">@"网络繁忙，请稍后再试！"</span>];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 解析XML数据</span></div><div class="line">    </div><div class="line">    <span class="comment">// 加载整个XML数据</span></div><div class="line">    GDataXMLDocument *doc = [[GDataXMLDocument alloc] initWithData:data options:<span class="number">0</span> error:<span class="literal">nil</span>];</div><div class="line">    </div><div class="line">    <span class="comment">// 获得文档的根元素 -- videos元素</span></div><div class="line">    GDataXMLElement *root = doc.rootElement;</div><div class="line">    </div><div class="line">    <span class="comment">// 获得根元素里面的所有video元素</span></div><div class="line">    <span class="built_in">NSArray</span> *elements = [root elementsForName:<span class="string">@"video"</span>];</div><div class="line">    </div><div class="line">    <span class="comment">// 遍历所有的video元素</span></div><div class="line">    <span class="keyword">for</span> (GDataXMLElement *videoElement <span class="keyword">in</span> elements) &#123;</div><div class="line">        HMVideo *video = [[HMVideo alloc] init];</div><div class="line">        </div><div class="line">        <span class="comment">// 取出元素的属性</span></div><div class="line">        video.id = [videoElement attributeForName:<span class="string">@"id"</span>].stringValue.intValue;</div><div class="line">        video.length = [videoElement attributeForName:<span class="string">@"length"</span>].stringValue.intValue;</div><div class="line">        video.name = [videoElement attributeForName:<span class="string">@"name"</span>].stringValue;</div><div class="line">        video.image = [videoElement attributeForName:<span class="string">@"image"</span>].stringValue;</div><div class="line">        video.url = [videoElement attributeForName:<span class="string">@"url"</span>].stringValue;</div><div class="line">        </div><div class="line">        <span class="comment">// 添加到数组中</span></div><div class="line">        [<span class="keyword">self</span>.videos addObject:video];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 刷新表格</span></div><div class="line">    [<span class="keyword">self</span>.tableView reloadData];</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<p>##NSXMLParser SAX 方式<br>SAX 是一条一条读取 XML 语句, 用在 XML 文件比较大的场景<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> 加载服务器最新的视频信息</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="comment">// 1.创建URL</span></div><div class="line"><span class="built_in">NSURL</span> *url = HMUrl(<span class="string">@"video?type=XML"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 2.创建请求</span></div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</div><div class="line"></div><div class="line"><span class="comment">// 3.发送请求</span></div><div class="line">[<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *connectionError) &#123;</div><div class="line">    <span class="keyword">if</span> (connectionError || data == <span class="literal">nil</span>) &#123;</div><div class="line">        [MBProgressHUD showError:<span class="string">@"网络繁忙，请稍后再试！"</span>];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 解析XML数据</span></div><div class="line">    </div><div class="line">    <span class="comment">// 1.创建XML解析器 -- SAX -- 逐个元素往下解析</span></div><div class="line">    <span class="built_in">NSXMLParser</span> *parser = [[<span class="built_in">NSXMLParser</span> alloc] initWithData:data];</div><div class="line">    </div><div class="line">    <span class="comment">// 2.设置代理</span></div><div class="line">    parser.delegate = <span class="keyword">self</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// 3.开始解析（同步执行）</span></div><div class="line">    [parser parse];</div><div class="line">    </div><div class="line">    <span class="comment">// 4.刷新表格</span></div><div class="line">    [<span class="keyword">self</span>.tableView reloadData];</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">#pragma mark - NSXMLParser的代理方法</div><div class="line">/**</div><div class="line"> *  解析到文档的开头时会调用</div><div class="line"> */</div><div class="line">- (void)parserDidStartDocument:(NSXMLParser *)parser</div><div class="line">&#123;</div><div class="line">//    NSLog(@&quot;parserDidStartDocument----&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  解析到一个元素的开始就会调用</div><div class="line"> *</div><div class="line"> *  @param elementName   元素名称</div><div class="line"> *  @param attributeDict 属性字典</div><div class="line"> */</div><div class="line">- (void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName attributes:(NSDictionary *)attributeDict</div><div class="line">&#123;</div><div class="line">    if ([@&quot;videos&quot; isEqualToString:elementName]) return;</div><div class="line">    </div><div class="line">    HMVideo *video = [HMVideo videoWithDict:attributeDict];</div><div class="line">    [self.videos addObject:video];</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  解析到一个元素的结束就会调用</div><div class="line"> *</div><div class="line"> *  @param elementName   元素名称</div><div class="line"> */</div><div class="line">- (void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName</div><div class="line">&#123;</div><div class="line">//    NSLog(@&quot;didEndElement----%@&quot;, elementName);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  解析到文档的结尾时会调用（解析结束）</div><div class="line"> */</div><div class="line">- (void)parserDidEndDocument:(NSXMLParser *)parser</div><div class="line">&#123;</div><div class="line">//    NSLog(@&quot;parserDidEndDocument----&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars0.githubusercontent.com/u/6646773?v=3&u=6c86b82133a822fe0a34359b9197bed3b38d328c&s=400"
               alt="LuXinyan" />
          <p class="site-author-name" itemprop="name">LuXinyan</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/luxinyan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/u/1080848494" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LuXinyan</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
